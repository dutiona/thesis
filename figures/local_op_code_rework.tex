\documentclass[varwidth=8cm, border={0.1cm 0.1cm 0.1cm 0.1cm}]{standalone}

\usepackage{minted}

\setminted[python]{fontsize=\scriptsize}

\begin{document}

\begin{minted}[highlightlines=8,highlightcolor=yellow!60!white,escapeinside=||]{c++}
  template <Image In, StructuringElement SE,
            WritableImage Out, class Op>
  void local_op(const In& ima, const SE& se,
              Out& out, Op&& op){
    for(auto pnt : ima.points()) {
      out(pnt) = ima(pnt);
      for(auto nbx : se(pnt))
        out(pnt) = |\colorbox{red!50!white}{op}|(out(pnt), img(nx));
    }
  }
\end{minted}

\end{document}
